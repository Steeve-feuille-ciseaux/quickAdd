{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>Liste des élèves inscrits</title>
    <link rel="stylesheet" href="{% static 'css/liste.css' %}">
</head>
<body>
    <div id="Up" class="container">
        <h1>Club informatique</h1>

        <div style="display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
            <a href="{% url 'ajouter_etudiant' %}"
            style="padding: 8px 16px; font-size: 1rem; background: #27ae60; color: white; text-decoration: none; border-radius: 4px; font-weight: bold;">
                Ajouter un élève
            </a>

            <a href="{% url 'appel' %}" style="padding: 8px 16px; background: #f39c12; color: white; text-decoration: none; font-weight: bold; border-radius: 4px;">
                Faire l'appel
            </a>
            <a onclick="window.print()"
                style="padding: 8px 16px; font-size: 1rem; background: white; color: #2c3e50; border: 2px solid #2c3e50; border-radius: 4px; font-weight: bold; cursor: pointer; text-decoration: none;">
                Imprimer la liste
            </a>

            <a href="{% url 'export_word' %}"
            style="padding: 8px 16px; background: #2980b9; color: white; text-decoration: none; font-weight: bold; border-radius: 4px;">
                Exporter en Word
            </a>
        </div>

        {% if etudiants %}
            <!-- Tableau résumé -->
            <table>
                <thead>
                    <tr>
                        <th>Total inscrits</th>
                        {% for niveau, count in inscrits_par_niveau.items %}
                            <th>{{ niveau }}ième</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>{{ total_inscrits }}</td>
                        {% for niveau, count in inscrits_par_niveau.items %}
                            <td>{{ count }}</td>
                        {% endfor %}
                    </tr>
                </tbody>
            </table>

            <!-- Tableau détails étudiants -->
            <table>
                <thead>
                    <tr>
                        <th>Prénom</th>
                        <th>Nom</th>
                        <th>Classe</th>
                        <th>Thème</th>
                        <th>Date d'inscription</th>
                        <th>Dernière présence</th>
                        <th>Cours suivi</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in etudiants %}
                        {% with etudiant=item.instance %}
                        <tr class="clickable-row" style="cursor:pointer;" data-info="information spécial">
                            <td>{{ etudiant.prenom }}</td>
                            <td>{{ etudiant.nom }}</td>
                            <td>{{ etudiant.niveau }} {{ etudiant.classe|upper }}</td>
                            <td>{{ etudiant.get_theme_display }}</td>
                            <td>
                                {{ etudiant.date_inscription|date:"d/m/Y" }}
                                {{ item.delai }}
                            </td>
                            <td>
                                {% if etudiant.date_presence %}
                                    {{ etudiant.date_presence|date:"d/m/Y" }}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>{{ etudiant.cours_suivi }}</td>
                        </tr>
                        {% endwith %}
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>Aucun étudiant inscrit.</p>
        {% endif %}

        <a href="#Up">Remonter en Haut</a>
    </div>

    <!-- Modale pop-up cachée -->
    <div id="infoModal" style=" display:none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000;">
        <div style="background: white; padding: 20px; border-radius: 8px; max-width: 300px; text-align: center; box-shadow: 0 0 10px rgba(0,0,0,0.3);">
            <p id="modalMessage" style="font-weight: bold;">information spécial</p>
            <button id="closeModal" style=" margin-top: 15px; padding: 8px 16px; background-color: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer;">
                Fermer
            </button>
        </div>
    </div>

    <script src="{% static 'js/tri.js' %}" defer></script>
    <script src="{% static 'js/infoEleve.js' %}" defer></script>
</body>
</html>
