{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>Liste des élèves inscrits</title>
    <link rel="stylesheet" href="{% static 'css/liste.css' %}">
    <link rel="stylesheet" href="{% static 'css/infoEleve.css' %}">
</head>
<body>
    <div id="Up" class="container">
        <h1>Club informatique</h1>

        <div style="display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
            <a href="{% url 'ajouter_etudiant' %}" class="btn green">Ajouter un élève</a>
            <a href="{% url 'appel' %}" class="btn orange">Faire l'appel</a>
            <a onclick="window.print()" class="btn outline">Imprimer la liste</a>
            <a href="{% url 'export_word' %}" class="btn blue">Exporter en Word</a>
        </div>

        {% if etudiants %}
            <!-- Tableau résumé -->
            <table>
                <thead>
                    <tr>
                        <th>Total inscrits</th>
                        {% for niveau, count in inscrits_par_niveau.items %}
                            <th>{{ niveau }}ième</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>{{ total_inscrits }}</td>
                        {% for niveau, count in inscrits_par_niveau.items %}
                            <td>{{ count }}</td>
                        {% endfor %}
                    </tr>
                </tbody>
            </table>

            <!-- Champ de recherche -->
            <div class="search-container">
                <form method="get" class="search-form">
                    <div class="search-input-group">
                        <input type="text" id="recherche" name="recherche" placeholder="Nom ou prénom" value="{{ recherche }}" class="search-input" />
                        <button type="submit" class="btn blue">Rechercher</button>
                    </div>
                </form>
            </div>

            <!-- Tableau détails étudiants -->
            <table>
                <thead>
                    <tr>
                        <th>Nom</th>
                        <th>Prénom</th>
                        <th>Classe</th>
                        <th>Thème</th>
                        <th>Date d'inscription</th>
                        <th>Dernière présence</th>
                        <th>Cours suivi</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in etudiants %}
                        {% with etudiant=item.instance %}
                        <tr class="clickable-row"
                            data-info="{{ etudiant.prenom }} {{ etudiant.nom }} - Classe {{ etudiant.niveau }}{{ etudiant.classe|upper }}"
                            data-theme="{{ etudiant.get_theme_display }}"
                            data-skill="{{ etudiant.get_skill_display }}"
                            data-objectif="{{ etudiant.objectif }}"
                            data-id="{{ etudiant.id }}"
                            style="cursor:pointer;">
                            <td>{{ etudiant.nom }}</td>
                            <td>{{ etudiant.prenom }}</td>
                            <td>{{ etudiant.niveau }} {{ etudiant.classe|upper }}</td>
                            <td>{{ etudiant.get_theme_display }}</td>
                            <td>
                                {{ etudiant.date_inscription|date:"d/m/Y" }}
                                {{ item.delai }}
                            </td>
                            <td>
                                {% if etudiant.date_presence %}
                                    {{ etudiant.date_presence|date:"d/m/Y" }}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>{{ etudiant.cours_suivi }}</td>
                        </tr>
                        {% endwith %}
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>Aucun étudiant inscrit.</p>
        {% endif %}

        <a href="#Up">Remonter en Haut</a>
    </div>

    <!-- Modale pop-up -->
    <div id="infoModal" class="modal">
        <div class="modal-content">
            <span id="closeModal" class="close-button">&times;</span>
            <p id="modalMessage" class="modal-text">Information élève</p>
            <p class="modal-text" id="modalTheme"><strong>Thème :</strong> </p>
            <p class="modal-text" id="modalObjectif"><strong>Objectif :</strong> </p>
            <p class="modal-text" id="modalSkill"><strong>Compétence :</strong> </p>
            <a id="modifierBtn" href="#" class="modal-button" style="background-color: #2980b9; display: inline-block; margin-top: 10px;">Modifier</a>
        </div>
    </div>

    <script src="{% static 'js/tri.js' %}" defer></script>
    <script src="{% static 'js/infoEleve.js' %}" defer></script>
</body>
</html>
